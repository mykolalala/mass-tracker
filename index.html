<!DOCTYPE html>
<html lang="uk">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Mass Nutrition Tracker</title>

<style>
:root{
  --bg:#0f0f0f;--card:#1c1c1e;--text:#fff;--green:#32d74b;--gray:#3a3a3c;
}
.light{
  --bg:#f2f2f7;--card:#fff;--text:#000;--green:#34c759;--gray:#ccc;
}
body{
  margin:0;font-family:-apple-system,system-ui;
  background:var(--bg);color:var(--text);
}
header{
  display:flex;justify-content:space-between;align-items:center;
  padding:16px;font-size:20px;font-weight:600;
}
button{
  background:var(--green);border:none;
  padding:10px 14px;border-radius:10px;
  font-weight:600;
}
.card{
  background:var(--card);
  margin:12px;padding:14px;border-radius:16px;
}
.progress{height:8px;background:var(--gray);border-radius:8px;}
.progress div{height:100%;background:var(--green);border-radius:8px;}
.grid{
  display:grid;grid-template-columns:repeat(7,1fr);
  gap:6px;margin-top:8px;
}
.day{
  width:100%;padding-top:100%;
  background:var(--gray);border-radius:6px;
}
.day.ok{background:var(--green);}
input{
  width:100%;padding:8px;border-radius:8px;
  border:none;margin-top:6px;
}
.light input{background:#eee;}
.month{margin-top:12px;}
.small{font-size:13px;opacity:.7;}
</style>
</head>

<body>
<header>
  <span>Mass Tracker</span>
  <button onclick="toggleTheme()">üåó</button>
</header>

<div class="card">
<h3>üî• –•–∞—Ä—á—É–≤–∞–Ω–Ω—è (—Å—å–æ–≥–æ–¥–Ω—ñ)</h3>

<p>–ö–∞–ª–æ—Ä—ñ—ó: <b id="calLeft"></b></p>
<div class="progress"><div id="calBar"></div></div>

<p>–ë—ñ–ª–æ–∫: <b id="protLeft"></b> –≥</p>
<div class="progress"><div id="protBar"></div></div>

<button onclick="addFood()">‚ûï –î–æ–¥–∞—Ç–∏ —ó–∂—É</button>

<p class="small">–¶—ñ–ª—å –∫–∞–ª–æ—Ä—ñ–π</p>
<input type="number" id="goalInput" onchange="setGoal()">
</div>

<div class="card">
<h3>üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Ö–∞—Ä—á—É–≤–∞–Ω–Ω—è</h3>
<div id="months"></div>
<p class="small" id="streak"></p>
</div>

<div class="card">
<h3>‚öñÔ∏è –í–∞–≥–∞</h3>
<input type="number" step="0.1" placeholder="–í–∞–≥–∞ —Å—å–æ–≥–æ–¥–Ω—ñ (–∫–≥)" id="weightInput">
<button onclick="saveWeight()">–ó–±–µ—Ä–µ–≥—Ç–∏</button>
<p id="weightInfo" class="small"></p>
</div>

<script>
let data=JSON.parse(localStorage.getItem("massData"))||{
  goalCal:3000,goalProt:130,
  days:{},weights:{},theme:"dark"
};

const today=()=>new Date().toISOString().slice(0,10);

function update(){
  if(!data.days[today()]) data.days[today()]={cal:0,prot:0};
  let d=data.days[today()];

  calLeft.textContent=data.goalCal-d.cal;
  protLeft.textContent=data.goalProt-d.prot;

  calBar.style.width=Math.min(d.cal/data.goalCal*100,100)+"%";
  protBar.style.width=Math.min(d.prot/data.goalProt*100,100)+"%";

  goalInput.value=data.goalCal;

  renderMonths();
  renderWeight();

  localStorage.setItem("massData",JSON.stringify(data));
}

function addFood(){
  let c=+prompt("–ö–∞–ª–æ—Ä—ñ—ó?");
  let p=+prompt("–ë—ñ–ª–æ–∫ (–≥)?");
  if(c) data.days[today()].cal+=c;
  if(p) data.days[today()].prot+=p;
  update();
}

function setGoal(){
  data.goalCal=+goalInput.value||data.goalCal;
  update();
}

function renderMonths(){
  months.innerHTML="";
  let now=new Date();

  for(let m=0;m<3;m++){
    let d=new Date(now.getFullYear(),now.getMonth()-m,1);
    let key=d.getFullYear()+"-"+(d.getMonth()+1);
    let wrap=document.createElement("div");
    wrap.className="month";
    wrap.innerHTML="<b>"+d.toLocaleString("uk",{month:"long"})+"</b>";

    let g=document.createElement("div");
    g.className="grid";

    let daysInMonth=new Date(d.getFullYear(),d.getMonth()+1,0).getDate();
    let okCount=0;

    for(let i=1;i<=daysInMonth;i++){
      let date=`${d.getFullYear()}-${String(d.getMonth()+1).padStart(2,"0")}-${String(i).padStart(2,"0")}`;
      let div=document.createElement("div");
      div.className="day";
      if(data.days[date] && data.days[date].cal>=data.goalCal){
        div.classList.add("ok");okCount++;
      }
      g.appendChild(div);
    }
    wrap.appendChild(g);
    wrap.innerHTML+=`<div class="small">–í–∏–∫–æ–Ω–∞–Ω–æ: ${okCount}/${daysInMonth}</div>`;
    months.appendChild(wrap);
  }

  let streakCount=0;
  for(let i=0;;i++){
    let d=new Date();d.setDate(d.getDate()-i);
    let id=d.toISOString().slice(0,10);
    if(data.days[id] && data.days[id].cal>=data.goalCal) streakCount++;
    else break;
  }
  streak.textContent="üî• –°–µ—Ä—ñ—è –¥–Ω—ñ–≤: "+streakCount;
}

function saveWeight(){
  let w=+weightInput.value;
  if(w){data.weights[today()]=w;weightInput.value="";update();}
}

function renderWeight(){
  let dates=Object.keys(data.weights);
  if(!dates.length){weightInfo.textContent="";return;}
  let first=data.weights[dates[0]];
  let last=data.weights[dates[dates.length-1]];
  weightInfo.textContent=`–ü–æ—Ç–æ—á–Ω–∞: ${last} –∫–≥ | –ó–º—ñ–Ω–∞: ${(last-first).toFixed(1)} –∫–≥`;
}

function toggleTheme(){
  document.body.classList.toggle("light");
}
update();
</script>
</body>
</html>
